syntax = "proto3";


package containermaker;


// Defines the level of network exposure for a container
enum ExposureLevel {
  EXPOSURE_LEVEL_UNSPECIFIED = 0;  // Default unspecified value (proto3 requirement)
  EXPOSURE_LEVEL_INTERNAL = 1;      // only pod
  EXPOSURE_LEVEL_CLUSTER_LOCAL = 2; // service with cluster ip
  EXPOSURE_LEVEL_CLUSTER_EXTERNAL = 3; // service with external ip
  EXPOSURE_LEVEL_EXPOSED = 4;       // ingress level
}


// The publish information of the container
message PublishInformation {
  int32 publish_port = 1;  // the port of the service
  int32 target_port = 2;  // the port of the pod
  string protocol = 3;  // the protocol of the service
  optional int32 node_port = 4;  // the node port of the service. The service type must be NodePort to use this.
}


// Resource requirements for creating a container
message ResourceRequirements {
  optional string cpu_request = 1;
  optional string cpu_limit = 2;
  optional string memory_request = 3;
  optional string memory_limit = 4;
  optional string ephemeral_request = 5;
  optional string ephemeral_limit = 6;
  optional string snapshot_size_limit = 7;
}


// Represents configuration for creating a container
message CreateContainerRequest {
  string image_name = 1;  // name of the image to use
  string container_name = 2;  // name of the container
  string network_name = 3;  // name of the network
  ExposureLevel exposure_level = 4;  // exposure level of the container
  repeated PublishInformation publish_information = 5;  // list of publish information
  map<string, string> environment_variables = 6;  // environment variables
  optional ResourceRequirements resource_requirements = 7;  // resource requirements for the container
}


// Get Container Request
message GetContainerRequest {
    string container_id = 1;  // id of the container
    string network_name = 2;  // network of the container
}


// Delete Container Request
message DeleteContainerRequest {
    string container_id = 1;  // id of the container
    string network_name = 2;  // network of the container
}


// List Container Request
message ListContainerRequest {
    string network_name = 1;  // network of the containers
}


// Save Container Request
message SaveContainerRequest {
    string container_id = 1;  // id of the container
    string network_name = 2;  // network of the container
}


// Represents the port information for the container response
message PortInformation {
    optional string name = 1;  // name of the port
    int32 container_port = 2;  // the actual container port
    optional string protocol = 3;  // the protocol of the container port
}


// Container resources in response (for associated resources)
message ContainerResources {
    string cpu_request = 1;
    string cpu_limit = 2;
    string memory_request = 3;
    string memory_limit = 4;
    string ephemeral_request = 5;
    string ephemeral_limit = 6;
    string snapshot_size_limit = 7;
}


// Associated resource (recursive structure for pod -> service -> ingress hierarchy)
message AssociatedResource {
    string resource_name = 1;  // name of the resource
    string resource_type = 2;  // type of resource: "pod", "service", "ingress"
    optional ContainerResources container_resources = 3;  // only present for pods
    repeated AssociatedResource associated_resources = 4;  // nested resources
}


// Represents container response
message ContainerResponse {
    string container_id = 1;  // the id of the container
    string container_name = 2;  // the name of the container
    string container_ip = 3;  // the ip of the container
    string container_network = 4;  // the network of the container
    repeated PortInformation ports = 5;  // the port information of the container
    repeated AssociatedResource associated_resources = 6;  // associated resources (pods, services, ingresses)
}


// list container response
message ListContainerResponse {
    repeated ContainerResponse containers = 1;  // the list of containers
}


// delete container response
message DeleteContainerResponse {
    string container_id = 1;  // the id of the container
    string status = 2;  // the status of the container
}


// Represents the saved pod response
message SavedPodResponse {
    string pod_name = 1;  // the name of the pod
    string namespace_name = 2;  // the namespace of the pod
    string image_name = 3;  // the image of the pod
}

// Save container response
message SaveContainerResponse {
    repeated SavedPodResponse saved_pods = 1;  // the list of saved pods. Note: We should only have one pod in the list.
}